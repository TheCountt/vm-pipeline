---
- name: Update ubuntu
  ansible.builtin.apt:
   update_cache: yes

# tasks file for nginx
- name: install nginx
  ansible.builtin.apt:
    name: "nginx"
    state: present

- name: ensure nginx is started and enabled
  ansible.builtin.service:
     name: nginx 
     state: started 
     enabled: yes

- name: copy nginx config file
  ansible.builtin.copy:
    src: files/nginx.conf
    dest: /etc/nginx/nginx.conf 
    follow: yes
  notify: Restart nginx

- name: Remove default Nginx site configuration
  ansible.builtin.file:
    path: /etc/nginx/sites-enabled/default
    state: absent
  notify: Restart nginx

- name: Add www-data to jenkins group
  user:
    name: www-data
    groups: sudo
    append: yes  # Add to groups without removing from existing groups

- name: Create Nginx site configuration
  ansible.builtin.copy:
    src: files/{{ item }}
    dest: /etc/nginx/conf.d/{{ item }}
  loop:
   - loadbalancer.conf
  notify: Restart nginx

  